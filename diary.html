<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Diary</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic:400,700,800&amp;subset=korean" rel="stylesheet"><!-- webfont -->
    <link rel="stylesheet" href="diary.css"><!-- 외부 스타일 불러오는 방법 -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
</head>
<body>
    <div id="diary_content_wrap" class="container"><!-- diary input wrap-->
        <h2 class="main_title text-center">내 건강 일기</h2>
        <div id="diary_input">
            <form class="form" action="#">
                <div class="food_diary">
                    <label name="">식단</label>
                    <input type="text" id="" name="" value="">   
                </div>
                <div class="health_diary">
                    <label name="">운동</label>
                    <input type="text" id="" name="" value="">   
                </div>  
                <div class="write_diary_wrap">
                    <div class="form-check-wrap">
                        <div class="form-check">
                            <input type="radio" class="check-btn" id="good" value="잘했음"><i class="far fa-grin"></i>
                        </div>
                        <div class="form-check">
                            <input type="radio" class="check-btn" id="normal" value="보통"><i class="far fa-flushed"></i>
                        </div>
                        <div class="form-check">
                            <input type="radio" class="check-btn" id="bad" value="힘들었음"><i class="far fa-angry"></i>
                        </div>
                        <button id="SaveButton" class="write_diary_save">저장</button>
                    </div>
                    
                    <div class="write_diary">
                        <textarea name="content" cols="100" rows="8" id="writeDiary"></textarea>
                    </div>  
                    <div id="showDiary" style="border:1px solid black; width:100%; height:auto;">

                    </div> 
                </div>           
            </form>
        </div>
    </div><!-- //diary input wrap-->
    <div id="diary_history_wrap"><!-- diary_history_wrap -->
        <div class="container">         
            <div class="row">
                <div class="diary_history"></div>
                <div class="diary_history"></div>
                <div class="diary_history"></div>
                <div class="diary_history"></div>
                <div class="diary_history"></div>
            </div>
        </div>
    </div><!-- //diary_history_wrap -->


    <script type="text/javascript">
        var storage_key = "records";
        records = {};

        // 처음 load할 때마다 반복
        function load(){
            if (localStorage.getItem(storage_key) != null){ // localStorage에 storage_key 값이 있다면
                records = JSON.parse(localStorage.getItem(storage_key)); // records는 localStorage에 있는 storage_key값을 불러온다. (getItem이 불러오는것)
                console.log('있는 records 가져옴');

            } else {
                 console.log('레코드없음');
                 return;
            }                
        }

        $(function() {
            load();

            // 저장버튼 click시
            var diary = {};
            diary['emotion'] = "good";  //사용자가 오늘 선택한 이모션 넣기

            diary['content'] = $('#input').val();
            /*
            diary['content'] = $('#input').val(); //사용자가 오늘 작성한 내용 넣기*/

            var info = {};
            info['diary_key'] = diary;   //사용자의 일기 정보를 info 딕셔너리의 diary_key의 value로 넣음

            // var records = {};   //처음에만 만들고 이미 localStorage에 저장된 records가 있으면 그걸 getItem해서 가져올거임
            records['19-03-26'] = info; //records에 오늘 날짜를 key로 해서 정보를 저장

            localStorage.setItem(storage_key, JSON.stringify(records));
            // 오늘 날짜를 추가한 records를 다시 localStorage에 저장
        });


        $(".form").submit(function(e) {
            e.preventDefault();
        });

        $(".check-btn").change(function(e) { // check-btn이 중복 선택되기 때문에 중복선택되지 않게 change변경
            $(".check-btn")[0].checked = false; // check-btn 첫번째는 false
            $(".check-btn")[1].checked = false; // check-btn 두번째는 false
            $(".check-btn")[2].checked = false; // check-btn 세번째는 false
            $(this)[0].checked = true; // 현재 클릭된 check-btn은 true
        });// 체크버튼되는 걸 처음에 모두 false 로 바꿨다가 this 마지막 현재 체크된 버튼만 true 로 변경해서 보여준다.
        
       
        $('#showDiary').hide();
        $("#SaveButton").click(function(e){
            var checkbtn;
            var diary = {};

            e.preventDefault();

            if($('.check-btn:checked')[0].id=="good"){ // 만약 사용자가 체크한 버튼의 id가 good일 경우 
                checkbtn = '<i class="far ' + "fa-grin" + '"></i>'; // checkbtn은 class가 fa-grin 인 아이콘이 된다. 
                diary['emotion'] = "good"; // good 의 emotion을 diary에 담는다
            } else if ($('.check-btn:checked')[0].id=="normal") { // 사용자가 체크한 버튼의 id가 normal 일 경우 
                checkbtn = '<i class="far ' + "fa-flushed" + '"></i>'; // checkbtn은 class가 fa-flushed 인 아이콘이 된다. 
                diary['emotion'] = "normal";  // normal 의 emotion을 diary에 담는다 
            } else if ($('.check-btn:checked')[0].id=="bad") { // 사용자가 체크한 버튼의 id가 bad일 경우 
                checkbtn = '<i class="far ' + "fa-angry" + '"></i>'; // checkbtn은 class가 fa-angry 인 아이콘이 된다. 
                diary['emotion'] = "bad";  // bad 의 emotion을 diary에 담는다 
            }
            $("#showDiary").append(checkbtn); // checkbtn을 #showDiary라는 아이디를 가진곳에 append(추가)
            $(".diary_history").append(checkbtn);// checkbtn을 .diary_history라는 클래스를 가진곳에 append(추가)

            var writeDiary =  $("#writeDiary").val();
            diary['content'] = writeDiary;//사용자가 오늘 작성한 내용 넣기*/

            var info = {}; // info는 전체를 담는 key값 
            info['diary_key'] = diary;   
            records['19-03-24'] = info; // records key에 info 내용을 담는다.

            localStorage.setItem(storage_key, JSON.stringify(records));


            $("#showDiary").append(writeDiary); 
            $(".diary_history").append(writeDiary); 
            $('#writeDiary').hide();
            $('#showDiary').show();

            alert("Diary 에 저장되었습니다.")
        });


    </script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>